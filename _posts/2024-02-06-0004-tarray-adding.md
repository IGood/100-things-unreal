---
#layout: post
title:  "#4 - `TArray` adding"
date:   2024-02-06 22:22:22 -0800
tags: tarray containers
---
{% include post_header.html %}
Know your options for adding elements to a `TArray`.

This could be a long post, going into a lot of detail, but I'm going to try to keep it short.

There's basically 2 families of methods: `Add` & `Emplace`.

Official Unreal documentation says:
> In general, `Emplace` is preferable to `Add`, in that it avoids creating unnecessary temporary variables at the call site which are then copied or moved into the container. As a rule of thumb, use `Add` for trivial types and `Emplace` otherwise. `Emplace` will never be less efficient than `Add`, but `Add` may read better.

They fail to mention that `Add` also has the overhead of a call to `CheckAddress` (which is cheap, not free).\
So, yeah: Prefer `Emplace`.

```cpp
// given...
struct FMyStruct {
    FMyStruct(int32 A, int32 B);
    ...
};

// ğŸ‘ write this:
MyArray.Emplace(123, 456);

// ğŸ‘ not that:
FMyStruct NewThing(123, 456);
MyArray.Add(NewThing);
```

---

I'm a big fan of the `Xxx_GetRef` versions of these methods so I can create a new element & begin using it immediately without needing to index into the array (because indexing is also cheap, but not free).

```cpp
// ğŸ‘ write this:
FMyStruct& NewThing = MyArray.AddDefaulted_GetRef();
NewThing.DoSomething();

// ğŸ‘ not that:
const int32 IndexOfNewThing = MyArray.AddDefaulted();
MyArray[IndexOfNewThing].DoSomething();

// ğŸ‘ not that:
MyArray.AddDefaulted();
MyArray.Last().DoSomething();
```
